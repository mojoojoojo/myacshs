<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=0" />
<title>myACSHS ‚Äî Official Portal</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
<style>
  :root {
    --bg-1: #f8fafc; --bg-2: #f1f5f9;
    --primary: #2563eb; --primary-hover: #1d4ed8;
    --accent: #6a11cb;
    --muted: #64748b; --text: #0f172a;
    --card: #ffffff;
    --danger: #ef4444; --success: #16a34a; --warning: #f59e0b;
    --radius: 12px;
    --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
  }

  * { box-sizing: border-box; outline: none; -webkit-tap-highlight-color: transparent; }
  
  body {
    margin: 0; font-family: 'Inter', sans-serif;
    background: var(--bg-1); color: var(--text);
    padding: 15px; display: flex; justify-content: center; min-height: 100vh;
    overflow-x: hidden;
  }

  .app { width: 100%; max-width: 1200px; display: flex; gap: 20px; flex-direction: column; }
  
  header.app-header { display: flex; align-items: center; justify-content: space-between; gap: 12px; flex-wrap: wrap; }
  .brand { display: flex; gap: 12px; align-items: center; }
  .logo { width: 42px; height: 42px; border-radius: 10px; background: linear-gradient(135deg, var(--accent), var(--primary)); color: white; display: flex; align-items: center; justify-content: center; font-weight: 800; font-size: 16px; box-shadow: 0 4px 12px rgba(37,99,235,0.2); }
  .title { font-weight: 700; font-size: 18px; color: var(--text); } 
  .subtitle { color: var(--muted); font-size: 13px; }

  .card { 
    background: var(--card); border-radius: var(--radius); padding: 20px; 
    box-shadow: var(--shadow); border: 1px solid #e2e8f0; width: 100%;
  }
  
  .center-view { display: flex; align-items: center; justify-content: center; min-height: 70vh; flex-direction: column; width: 100%; }

  /* Forms */
  label { display: block; font-size: 13px; font-weight: 500; color: var(--muted); margin-bottom: 6px; }
  input, select, textarea { 
    width: 100%; padding: 11px 12px; border-radius: 8px; border: 1px solid #cbd5e1; 
    font-size: 14px; background: #fff; transition: border-color 0.2s;
  }
  input:focus { border-color: var(--primary); }

  /* Show Password Feature */
  .pass-wrapper { position: relative; width: 100%; }
  .pass-wrapper input { padding-right: 40px; }
  .pass-toggle {
    position: absolute; right: 0; top: 0; height: 100%; width: 40px;
    display: flex; align-items: center; justify-content: center;
    cursor: pointer; color: var(--muted);
  }

  button { 
    padding: 11px 16px; border-radius: 8px; border: none; cursor: pointer; 
    font-weight: 600; font-size: 14px; transition: all 0.2s ease; display: inline-flex; align-items: center; justify-content: center; gap: 6px;
  }
  button.primary { background: var(--primary); color: white; }
  button.primary:hover { background: var(--primary-hover); }
  button.ghost { background: transparent; border: 1px solid #cbd5e1; color: var(--muted); }
  button.danger { background: #fee2e2; color: var(--danger); }
  button.danger:hover { background: var(--danger); color: white; }

  /* Grid Layouts */
  .grid { display: grid; grid-template-columns: 1fr 320px; gap: 20px; width: 100%; } 
  @media (max-width: 900px){ .grid{ grid-template-columns: 1fr; } }

  /* Tabs */
  .tabs { display: flex; gap: 8px; overflow-x: auto; padding-bottom: 12px; border-bottom: 1px solid #e2e8f0; margin-bottom: 16px; -webkit-overflow-scrolling: touch; } 
  .tabs button { white-space: nowrap; background: transparent; color: var(--muted); border: none; padding: 8px 14px; font-weight: 500; border-radius: 6px; } 
  .tabs button.active { background: var(--primary); color: white; }

  /* Tables & Responsive Scrolling */
  .table-container { 
    overflow-x: auto; -webkit-overflow-scrolling: touch; 
    border-radius: 8px; border: 1px solid #e2e8f0; 
    max-width: 100%; background: white;
  }
  table { width: 100%; border-collapse: collapse; font-size: 14px; min-width: 600px; } 
  th, td { padding: 12px 16px; border-bottom: 1px solid #e2e8f0; text-align: left; }
  th { background: #f8fafc; color: var(--muted); font-size: 11px; font-weight: 700; text-transform: uppercase; letter-spacing: 0.05em; }
  
  /* Mobile Table View (Stacks rows into cards) */
  @media (max-width: 600px){
    table, thead, tbody, th, td, tr { display: block; width: 100%; }
    thead { display: none; }
    .table-container { border: none; background: transparent; }
    tr { background: var(--card); margin-bottom: 15px; border: 1px solid #e2e8f0; border-radius: 8px; padding: 12px; box-shadow: var(--shadow); }
    td { padding: 10px 0; border: none; display: flex; justify-content: space-between; align-items: center; border-bottom: 1px dashed #e2e8f0; }
    td:last-child { border-bottom: none; }
    td::before { content: attr(data-label); font-weight: 600; color: var(--muted); font-size: 12px; }
  }

  /* Utility */
  .pill { background: #f1f5f9; padding: 4px 10px; border-radius: 99px; font-size: 12px; font-weight: 600; }
  .hr { height: 1px; background: #e2e8f0; margin: 16px 0; width: 100%; }
  .row { display: flex; gap: 12px; flex-wrap: wrap; } 
  .col { flex: 1; min-width: 180px; }

  /* Avatars */
  .avatar-container { text-align: center; }
  .avatar { width: 100px; height: 100px; object-fit: cover; border-radius: 8px; border: 3px solid white; box-shadow: var(--shadow); background: #e2e8f0; }
  .avatar-placeholder { width: 100px; height: 100px; background: #e0e7ff; color: var(--primary); display: flex; align-items: center; justify-content: center; font-size: 32px; font-weight: 800; border-radius: 8px; margin: 0 auto; border: 3px solid white; box-shadow: var(--shadow); }
  .thumb { width: 32px; height: 32px; border-radius: 4px; object-fit: cover; vertical-align: middle; margin-right: 8px; }

  /* Animations */
  .fade-in { animation: fadeIn 0.4s ease forwards; opacity: 0; }
  @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

  .link-btn { background: none; border: none; color: var(--primary); text-decoration: underline; padding: 0; cursor: pointer; font-size: 13px; font-weight: 500; }
</style>
</head>
<body>

<div class="app">
  <header class="app-header">
    <div class="brand">
      <div class="logo">AC</div>
      <div><div class="title">myACSHS</div><div class="subtitle">Secure Portal</div></div>
    </div>
  </header>

  <main id="loginView" class="center-view fade-in">
    <div class="card" style="max-width: 400px;">
      <h2 style="margin: 0 0 10px 0; text-align: center;">Welcome</h2>
      <p style="text-align: center; color: var(--muted); font-size: 14px; margin-bottom: 24px;">Please sign in to your account</p>

      <label>Role</label>
      <select id="loginRole" style="margin-bottom: 16px;">
        <option value="student">Student</option>
        <option value="admin">Administrator</option>
      </select>

      <label>ID / Username</label>
      <input id="loginId" type="text" placeholder="ID Number" style="margin-bottom: 16px;">

      <label>Password</label>
      <div class="pass-wrapper" style="margin-bottom: 20px;">
        <input id="loginPass" type="password" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
        <div class="pass-toggle" onclick="togglePass('loginPass')">üëÅÔ∏è</div>
      </div>

      <button class="primary" onclick="login()" style="width: 100%;">Sign In</button>
      
      <div style="margin-top: 16px; text-align: center;">
        <button class="link-btn" onclick="showForgotPass()">Forgot Password?</button>
      </div>
      <div style="margin-top: 20px; font-size: 11px; color: var(--muted); text-align: center; border-top:1px dashed #cbd5e1; padding-top:10px;">
        Demo Student ID: <b>1202</b> <br> Pass: <b>password</b>
      </div>
    </div>
  </main>

  <main id="forgotView" class="center-view fade-in" style="display:none">
    <div class="card" style="max-width: 400px;">
      <h2 style="margin: 0 0 8px 0; text-align: center;">Reset Password</h2>
      <p style="text-align: center; color: var(--muted); font-size: 14px; margin-bottom: 24px;">Verify your identity to set a new password</p>

      <label>Student ID</label>
      <input id="recId" type="text" placeholder="e.g. 12-3456" style="margin-bottom: 16px;">

      <label>Slip Number (Verification)</label>
      <input id="recSlip" type="text" placeholder="Check your enrollment slip" style="margin-bottom: 16px;">

      <label>New Password</label>
      <div class="pass-wrapper" style="margin-bottom: 24px;">
        <input id="recNewPass" type="password" placeholder="New Password">
        <div class="pass-toggle" onclick="togglePass('recNewPass')">üëÅÔ∏è</div>
      </div>

      <button class="primary" onclick="processReset()" style="width: 100%;">Save Changes</button>
      <button class="ghost" onclick="showLogin()" style="width: 100%; margin-top:8px">Back to Login</button>
    </div>
  </main>

  <section id="dashboardView" style="display:none" class="fade-in">
    <div class="grid">
      <div style="min-width: 0;"> 
        <div class="card">
          <div style="display:flex; justify-content:space-between; align-items:center; flex-wrap: wrap; gap: 10px; margin-bottom: 20px;">
            <div>
              <div id="userTitle" style="font-weight:700; font-size:22px;">...</div>
              <div id="userMeta" class="subtitle">...</div>
            </div>
            <button class="danger ghost" onclick="logout()" style="border: 1px solid #fee2e2;">Logout</button>
          </div>

          <div id="tabsArea" class="tabs"></div>
          <div id="mainArea" class="fade-in"></div>
        </div>
      </div>

      <aside>
        <div class="card">
          <div class="subtitle" style="text-transform: uppercase; font-weight: 700; letter-spacing: 0.5px;">Dashboard Stats</div>
          <div style="font-weight:600; font-size: 16px; margin: 8px 0;" id="todayDate"></div>
          <div class="hr"></div>
          <div id="quickPills" style="display:flex; gap:8px; flex-wrap:wrap"></div>
          <div style="margin-top:16px; font-size: 13px; line-height: 1.5;" id="rightShort"></div>
        </div>
      </aside>
    </div>
  </section>
</div>

<script>
/* --- DB Keys & Defaults --- */
const KEYS = { USERS:'ac_user_db', ATT:'ac_att_db', GRADES:'ac_grade_db', SCHED:'ac_sched_db', SESSION: 'ac_active_session' };
const ADMIN = { username:'admin', password:'admin123' };

/* --- Storage Helpers --- */
function read(key){ try { return JSON.parse(localStorage.getItem(key)) || []; } catch(e){ return []; } }
function write(key, val){ localStorage.setItem(key, JSON.stringify(val)); }
function getMMDD(date){ if(!date) return ''; const p=date.split('-'); return p.length===3 ? p[1]+p[2] : ''; }

/* --- App State --- */
let state = { role: null, user: null };

/* --- Initialization with Image Data --- */
function initData(){
  // 1. Initialize Student User (ICT 1202)
  let users = read(KEYS.USERS);
  if(!users.find(u => u.id === '1202')){
    users.push({ 
      id: '1202', 
      password: 'password', 
      slipNumber: 'ICT-SLIP', 
      firstName: 'Student', 
      lastName: 'ICT 1202', 
      track: 'ICT 1202 (Mrs. Sofia)', 
      birth: '2005-01-01', 
      avatar: null 
    });
    write(KEYS.USERS, users);
  }

  // 2. Initialize Schedule from Image
  // Schedule for ICT 1202 (Mrs. Jenelyn V. Sofia)
  let sched = read(KEYS.SCHED);
  if(sched.length === 0){
    const newSched = [
      { subject: "Homeroom Guidance", time: "Mon 6:15-7:15", room: "Adviser" },
      { subject: "Media and Information Literacy", time: "Tue-Fri 6:15-7:15", room: "Mrs. Sofia" },
      { subject: "JAVA", time: "Mon-Fri 7:15-8:15", room: "Sir Espiritu" },
      { subject: "--- BREAK ---", time: "Mon-Fri 8:15-8:35", room: "---" },
      { subject: "Physical Education & Health", time: "Mon 8:35-9:35", room: "Sir Jordan" },
      { subject: "JAVA", time: "Tue, Thu, Fri 8:35-9:35", room: "Sir Espiritu" },
      { subject: "Inquiries, Investigations, Immersion", time: "Wed 8:35-9:35", room: "Sir Inocian" },
      { subject: "Inquiries, Investigations, Immersion", time: "Mon, Tue, Thu 9:35-10:35", room: "Sir Inocian" },
      { subject: "Work Immersion", time: "Wed, Fri 9:35-10:35", room: "Sir Espiritu" },
      { subject: "Work Immersion", time: "Mon, Tue 10:35-11:35", room: "Sir Espiritu" }
    ];
    write(KEYS.SCHED, newSched);
  }
}

/* --- Auth Logic --- */
function togglePass(id){
  const el = document.getElementById(id);
  el.type = el.type === 'password' ? 'text' : 'password';
}

function showForgotPass(){ loginView.style.display='none'; forgotView.style.display='flex'; }
function showLogin(){ forgotView.style.display='none'; loginView.style.display='flex'; }

function login(){
  const role = document.getElementById('loginRole').value;
  const id = document.getElementById('loginId').value.trim();
  const pass = document.getElementById('loginPass').value.trim();

  if(role === 'admin'){
    if(id === ADMIN.username && pass === ADMIN.password){
      saveSession('admin', { username: 'Admin' });
    } else { alert('Incorrect Admin password.'); }
    return;
  }

  const users = read(KEYS.USERS);
  const u = users.find(x => x.id === id);
  if(!u){ alert('Student ID not found.'); return; }

  const defaultPass = `${u.id}-${getMMDD(u.birth)}`;
  const validPass = u.password || defaultPass;
  
  if(pass === validPass){ 
    saveSession('student', u);
  } else { alert('Wrong password.'); }
}

function saveSession(role, user){
  state = { role, user };
  localStorage.setItem(KEYS.SESSION, JSON.stringify(state));
  openDashboard();
}

function logout(){ 
  localStorage.removeItem(KEYS.SESSION);
  location.reload(); 
}

function processReset(){
  const id = document.getElementById('recId').value.trim();
  const slip = document.getElementById('recSlip').value.trim();
  const newPass = document.getElementById('recNewPass').value.trim();
  
  const users = read(KEYS.USERS);
  const idx = users.findIndex(u => u.id === id);
  
  if(idx > -1 && users[idx].slipNumber === slip){
    users[idx].password = newPass;
    write(KEYS.USERS, users);
    alert('Password updated successfully!');
    showLogin();
  } else {
    alert('Invalid ID or Slip Number.');
  }
}

/* --- Dashboard Logic --- */
const loginView = document.getElementById('loginView');
const forgotView = document.getElementById('forgotView');
const dashboardView = document.getElementById('dashboardView');
const tabsArea = document.getElementById('tabsArea');
const mainArea = document.getElementById('mainArea');

function openDashboard(){
  loginView.style.display = 'none';
  forgotView.style.display = 'none';
  dashboardView.style.display = 'block';
  
  document.getElementById('todayDate').innerText = new Date().toDateString();

  if(state.role === 'admin'){
    document.getElementById('userTitle').innerText = 'System Administrator';
    document.getElementById('userMeta').innerText = 'Portal Access Level 1';
    buildAdminTabs();
  } else {
    // Refresh student data from DB
    const fresh = read(KEYS.USERS).find(u => u.id === state.user.id);
    state.user = fresh || state.user;
    document.getElementById('userTitle').innerText = `${state.user.firstName} ${state.user.lastName}`;
    document.getElementById('userMeta').innerText = `ID: ${state.user.id} | ${state.user.track}`;
    buildStudentTabs();
  }
  updateSidebar();
}

function updateSidebar(){
  const pills = document.getElementById('quickPills');
  const short = document.getElementById('rightShort');
  pills.innerHTML = '';
  
  if(state.role === 'admin'){
    const count = read(KEYS.USERS).length;
    pills.innerHTML = `<div class="pill">${count} Enrolled</div>`;
    short.innerText = "Welcome back. You can manage student data and schedules from here.";
  } else {
    const absences = read(KEYS.ATT).filter(a => a.userId === state.user.id && a.status === 'Absent').length;
    pills.innerHTML = `<div class="pill" style="color:white; background:${absences>0?'var(--danger)':'var(--success)'}">${absences} Absences</div>`;
    short.innerText = "Please keep your Slip Number private. It is used for account recovery.";
  }
}

/* --- Tabs --- */
function buildAdminTabs(){
  tabsArea.innerHTML = '';
  const list = [
    { n: 'Students', f: renderManageStudents },
    { n: 'Attendance', f: renderAdminAttendance },
    { n: 'Grades', f: renderAdminGrades },
    { n: 'Schedule', f: renderAdminSchedule }
  ];
  list.forEach((t, i) => addTabBtn(t.n, i===0, t.f));
}

function buildStudentTabs(){
  tabsArea.innerHTML = '';
  const list = [
    { n: 'Profile', f: renderStudentProfile },
    { n: 'Schedule', f: renderStudentSchedule },
    { n: 'Attendance', f: renderStudentAttendance },
    { n: 'Grades', f: renderStudentGrades }
  ];
  list.forEach((t, i) => addTabBtn(t.n, i===0, t.f));
}

function addTabBtn(name, active, func){
  const b = document.createElement('button');
  b.innerText = name;
  if(active) { b.classList.add('active'); func(); }
  b.onclick = () => {
    Array.from(tabsArea.children).forEach(x => x.classList.remove('active'));
    b.classList.add('active');
    mainArea.innerHTML = '';
    func();
  };
  tabsArea.appendChild(b);
}

/* ================= ADMIN FUNCTIONS ================= */

function renderManageStudents(){
  const users = read(KEYS.USERS);
  const rows = users.map((u, i) => `
    <tr>
      <td data-label="Student">
        <div style="display:flex; align-items:center;">
          ${u.avatar ? `<img src="${u.avatar}" class="thumb">` : '<div class="thumb" style="background:#ddd"></div>'}
          <strong>${u.id}</strong>
        </div>
      </td>
      <td data-label="Name">${u.firstName} ${u.lastName}</td>
      <td data-label="Slip #">${u.slipNumber}</td>
      <td data-label="Actions">
        <button class="ghost" onclick="uploadPhoto(${i})" style="padding:4px 8px; font-size:11px">Photo</button>
        <button class="danger" onclick="delStudent(${i})" style="padding:4px 8px; font-size:11px">Del</button>
      </td>
    </tr>`).join('');

  mainArea.innerHTML = `
    <div class="fade-in">
      <h3>Student Management</h3>
      <div class="card" style="background:var(--bg-2); border:none; margin-bottom:20px;">
        <div class="row">
          <div class="col"><label>ID Number</label><input id="ni" placeholder="12-0001"></div>
          <div class="col"><label>Slip Number</label><input id="ns" placeholder="A100-XYZ"></div>
        </div>
        <div class="row" style="margin-top:10px">
          <div class="col"><label>First Name</label><input id="nf"></div>
          <div class="col"><label>Last Name</label><input id="nl"></div>
        </div>
        <div class="row" style="margin-top:10px">
          <div class="col"><label>Track</label><input id="nt" placeholder="STEM / ICT"></div>
          <div class="col"><label>Birth Date</label><input id="nb" type="date"></div>
        </div>
        <button class="primary" onclick="doAddStudent()" style="width:100%; margin-top:15px">Register Student</button>
      </div>
      <div class="table-container">
        <table><thead><tr><th>ID</th><th>Name</th><th>Slip</th><th>Actions</th></tr></thead><tbody>${rows}</tbody></table>
      </div>
    </div>`;
}

function doAddStudent(){
  const id=document.getElementById('ni').value, slip=document.getElementById('ns').value, f=document.getElementById('nf').value, l=document.getElementById('nl').value, t=document.getElementById('nt').value, b=document.getElementById('nb').value;
  if(!id||!slip||!f||!l||!b) return alert('Fill all fields');
  const db = read(KEYS.USERS);
  db.push({ id, slipNumber:slip, firstName:f, lastName:l, track:t, birth:b, avatar:null });
  write(KEYS.USERS, db);
  renderManageStudents(); updateSidebar();
}

function delStudent(i){ if(confirm('Delete?')){ const db=read(KEYS.USERS); db.splice(i,1); write(KEYS.USERS,db); renderManageStudents(); updateSidebar(); } }

function uploadPhoto(i){
  const el = document.createElement('input'); el.type='file'; el.accept='image/*';
  el.onchange = e => {
    const reader = new FileReader();
    reader.onload = ev => {
      const db = read(KEYS.USERS); db[i].avatar = ev.target.result;
      write(KEYS.USERS, db); renderManageStudents();
    };
    reader.readAsDataURL(e.target.files[0]);
  };
  el.click();
}

/* --- Admin Attendance --- */
function renderAdminAttendance(){
  const users = read(KEYS.USERS), logs = read(KEYS.ATT);
  const rows = logs.map((l, i) => `<tr><td data-label="ID">${l.userId}</td><td data-label="Date">${l.date}</td><td data-label="Status">${l.status}</td><td data-label="Action"><button class="danger" onclick="delAtt(${i})" style="padding:4px">X</button></td></tr>`).join('');
  mainArea.innerHTML = `
    <div class="fade-in">
      <h3>Attendance Logs</h3>
      <div class="row" style="margin-bottom:15px">
        <div class="col"><select id="au">${users.map(u=>`<option value="${u.id}">${u.id} - ${u.lastName}</option>`).join('')}</select></div>
        <div class="col"><input type="date" id="ad" value="${new Date().toISOString().split('T')[0]}"></div>
        <div class="col"><select id="as"><option>Present</option><option>Absent</option><option>Tardy</option></select></div>
        <button class="primary" onclick="doAddAtt()">Add</button>
      </div>
      <div class="table-container"><table><thead><tr><th>ID</th><th>Date</th><th>Status</th><th></th></tr></thead><tbody>${rows}</tbody></table></div>
    </div>`;
}
function doAddAtt(){ const db=read(KEYS.ATT); db.push({userId:document.getElementById('au').value, date:document.getElementById('ad').value, status:document.getElementById('as').value}); write(KEYS.ATT,db); renderAdminAttendance(); }
function delAtt(i){ const db=read(KEYS.ATT); db.splice(i,1); write(KEYS.ATT,db); renderAdminAttendance(); }

/* --- Admin Grades --- */
function renderAdminGrades(){
  const users = read(KEYS.USERS), grades = read(KEYS.GRADES);
  const rows = grades.map((g, i) => `<tr><td data-label="ID">${g.userId}</td><td data-label="Subject">${g.subject}</td><td data-label="Grade"><strong>${g.grade}</strong></td><td data-label="Action"><button class="danger" onclick="delGrd(${i})" style="padding:4px">X</button></td></tr>`).join('');
  mainArea.innerHTML = `
    <div class="fade-in">
      <h3>Academic Records</h3>
      <div class="row" style="margin-bottom:15px">
        <div class="col"><select id="gu">${users.map(u=>`<option value="${u.id}">${u.id}</option>`).join('')}</select></div>
        <div class="col"><input id="gs" placeholder="Subject"></div>
        <div class="col"><input id="gv" type="number" placeholder="Grade"></div>
        <button class="primary" onclick="doAddGrd()">Add</button>
      </div>
      <div class="table-container"><table><thead><tr><th>ID</th><th>Subject</th><th>Grade</th><th></th></tr></thead><tbody>${rows}</tbody></table></div>
    </div>`;
}
function doAddGrd(){ const db=read(KEYS.GRADES); db.push({userId:document.getElementById('gu').value, subject:document.getElementById('gs').value, grade:document.getElementById('gv').value}); write(KEYS.GRADES,db); renderAdminGrades(); }
function delGrd(i){ const db=read(KEYS.GRADES); db.splice(i,1); write(KEYS.GRADES,db); renderAdminGrades(); }

/* --- Admin Schedule --- */
function renderAdminSchedule(){
  const sched = read(KEYS.SCHED);
  const rows = sched.map((s, i) => `<tr><td data-label="Subj">${s.subject}</td><td data-label="Time">${s.time}</td><td data-label="Room">${s.room}</td><td data-label="Action"><button class="danger" onclick="delSch(${i})" style="padding:4px">X</button></td></tr>`).join('');
  mainArea.innerHTML = `
    <div class="fade-in">
      <h3>Class Schedule</h3>
      <div class="row" style="margin-bottom:15px">
        <div class="col"><input id="ss" placeholder="Subject"></div>
        <div class="col"><input id="st" placeholder="Time (e.g. 8-9AM)"></div>
        <div class="col"><input id="sr" placeholder="Room"></div>
        <button class="primary" onclick="doAddSch()">Add</button>
      </div>
      <div class="table-container"><table><thead><tr><th>Subject</th><th>Time</th><th>Room</th><th></th></tr></thead><tbody>${rows}</tbody></table></div>
    </div>`;
}
function doAddSch(){ const db=read(KEYS.SCHED); db.push({subject:document.getElementById('ss').value, time:document.getElementById('st').value, room:document.getElementById('sr').value}); write(KEYS.SCHED,db); renderAdminSchedule(); }
function delSch(i){ const db=read(KEYS.SCHED); db.splice(i,1); write(KEYS.SCHED,db); renderAdminSchedule(); }

/* ================= STUDENT FUNCTIONS ================= */

function renderStudentProfile(){
  const u = state.user;
  mainArea.innerHTML = `
    <div class="fade-in">
      <div class="avatar-container">
        ${u.avatar ? `<img src="${u.avatar}" class="avatar">` : `<div class="avatar-placeholder">${u.firstName[0]}</div>`}
        <h2 style="margin:10px 0 2px 0">${u.firstName} ${u.lastName}</h2>
        <div class="subtitle">${u.id} | ${u.track}</div>
      </div>
      <div class="hr"></div>
      <div class="row">
        <div class="col"><label>Birthday</label><div>${u.birth}</div></div>
        <div class="col"><label>Status</label><div class="text-success" style="font-weight:700">ENROLLED</div></div>
      </div>
    </div>`;
}

function renderStudentSchedule(){
  const rows = read(KEYS.SCHED).map(s => `<tr><td data-label="Subject"><b>${s.subject}</b></td><td data-label="Time/Day">${s.time}</td><td data-label="Teacher">${s.room}</td></tr>`).join('');
  mainArea.innerHTML = `<h3>My Schedule</h3><div class="table-container"><table><thead><tr><th>Subject</th><th>Time / Day</th><th>Teacher</th></tr></thead><tbody>${rows||'<tr><td colspan="3">No schedule posted.</td></tr>'}</tbody></table></div>`;
}

function renderStudentAttendance(){
  const rows = read(KEYS.ATT).filter(a=>a.userId===state.user.id).map(a => `<tr><td data-label="Date">${a.date}</td><td data-label="Status"><b>${a.status}</b></td></tr>`).join('');
  mainArea.innerHTML = `<h3>My Attendance</h3><div class="table-container"><table><thead><tr><th>Date</th><th>Status</th></tr></thead><tbody>${rows||'<tr><td colspan="2">No records found.</td></tr>'}</tbody></table></div>`;
}

function renderStudentGrades(){
  const rows = read(KEYS.GRADES).filter(g=>g.userId===state.user.id).map(g => `<tr><td data-label="Subject"><b>${g.subject}</b></td><td data-label="Grade" style="font-size:16px"><b>${g.grade}</b></td></tr>`).join('');
  mainArea.innerHTML = `<h3>Report Card</h3><div class="table-container"><table><thead><tr><th>Subject</th><th>Grade</th></tr></thead><tbody>${rows||'<tr><td colspan="2">Grades not yet released.</td></tr>'}</tbody></table></div>`;
}

/* --- Init --- */
window.onload = () => {
  initData(); // Inject Schedule from Image
  const saved = localStorage.getItem(KEYS.SESSION);
  if(saved){
    state = JSON.parse(saved);
    openDashboard();
  }
};
</script>

</body>
</html>
